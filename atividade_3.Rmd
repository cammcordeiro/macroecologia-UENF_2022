---
pagetitle: Atividade 3
output:
  html_document:
    pandoc_args: [
      "--number-offset=3"]
    toc: yes
    toc_float: true
    number_sections: true
    code_folding: "show"
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Atividade 3 {.unnumbered}

<br></br>

## Dados de peixes recifais
Para a atividade 4, partiremos dos primeiros passos da atividade 1, mas com algumas modificações na escala do mapa (global desta vez). Para tal, bastar realizar estes primeiros passos rodando este `chunck` de código abaixo. 

```{r}

library(letsR)
library(tidyverse)
library(rgdal)

# Importanto o shapefile
borb <- rgdal::readOGR(dsn = "data/Chaetodontidae_NewWorld.shp")

# Criando raster
borb_maps <- lets.presab(borb, resol = 3, 
                         cover = 0.01)

# Criando matrix de presença e ausência
borb_pa <- borb_maps$Presence_and_Absence_Matrix

```

```{r}
#carregando pacotes usados
library(maptools)
library(maps)
library(rgdal)
library(vegan)

```

### Barreiras biogeograficas

```{r}

#criar uma tabela com dados de presenca/ausencia das especies
pa <-as.data.frame(borb_maps$Presence_and_Absence_Matrix[,-c(1:2)])

#checar os nomes para ver se contem somente as especies
names(pa)

```

```{r}

# Calculando dissimilaridade na composição de espécies
library(betapart)
beta.sim <- betapart::beta.pair(pa,index.family="sorensen")$beta.sim

```


```{r}
###Visualizando a composição de especies por meio de um NMDS
library(vegan)

points <- vegan::metaMDS(beta.sim, k=2, autotransform=F, trymax=5)$points
```


```{r}
#Atribuindo cores de acordo com a composicao de especies (escala RedGreenBlue)
library(recluster)

cores <- recluster::recluster.col(points)
RGB <- data.frame(sites=rownames(cores),RGB=rgb(cores[,3:5],maxColorValue=255))

recluster::recluster.plot.col(cores,cex=5,cext=1)
```


```{r}

library(maps)
#criando um novo objeto contendo o mapa da composicao
mapa_comp <- borb_maps$Richness_Raster
#Atribuindo ao mapa as cores RGB
mapa_comp[mapa_comp[]==0]<-NA
mapa_comp[mapa_comp[]!=0]<-RGB$RGB

maps::map("world")
plot(mapa_comp,add=TRUE,axis=FALSE)

```


## Bibliography
-   Vilela B, Villalobos F (2015) letsR: A new r package for data handling and analysis in macroecology. Methods in Ecology and Evolution, 6, 1229–1234.